local localPlayer = game:GetService("Players").LocalPlayer
local currentCamera = game:GetService("Workspace").CurrentCamera
local mouse = localPlayer:GetMouse()

function getClosestPlayerToCursor()
    local closestPlayer = nil
    local shortestDistance = math.huge
    
    for i, v in pairs(game:GetService("Players"):GetPlayers()) do
       if v ~= localPlayer and v.Name ~= "Atomicals" and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 and v.Character:FindFirstChild("HumanoidRootPart") and v.Character:FindFirstChild("Head") and v.Team ~= game.Players.LocalPlayer.Team then
            local pos = currentCamera:WorldToViewportPoint(v.Character.HumanoidRootPart.Position)
            local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(mouse.X, mouse.Y)).magnitude

            if magnitude < shortestDistance then
                closestPlayer = v
                shortestDistance = magnitude
            end
        end
    end
    
    
    return closestPlayer
end

mouse.Button1Down:connect(function(key)

local success, err = pcall(function()
local gun = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
if game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool") and getClosestPlayerToCursor() ~= nil then
local args = {
    [1] = getClosestPlayerToCursor().Character.Head.Position,
    [2] = getClosestPlayerToCursor().Character.Head.CFrame,
    [3] = getClosestPlayerToCursor().Character,
    [5] = getClosestPlayerToCursor().Character.Head.Position,
    [7] = getClosestPlayerToCursor().Character.Head.Position,
    [8] = getClosestPlayerToCursor().Character.Head.Position,
    [9] = getClosestPlayerToCursor().Character.Head,
    [10] = 1,
    [11] = 111,
    [12] = game:GetService("Players").LocalPlayer,
    [13] = 30,
    [14] = 327.68,
    [15] = 28,
    [16] = 24,
    [17] = 2,
    [18] = getClosestPlayerToCursor().Character.Head.Position,
    [19] = 48,
    [20] = false
}

game:GetService("Players").LocalPlayer.Character[tostring(gun)].UnrealEngine.FireBullet:FireServer(unpack(args))
end
end)
end)
